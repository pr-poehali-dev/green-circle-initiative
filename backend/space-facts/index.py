import json
import random
from typing import Dict, Any

def handler(event: Dict[str, Any], context: Any) -> Dict[str, Any]:
    '''
    –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–ª—É—á–∞–π–Ω—ã—Ö —Ñ–∞–∫—Ç–æ–≤ –æ –∂–∏–≤–æ—Ç–Ω—ã—Ö
    Args: event - HTTP –∑–∞–ø—Ä–æ—Å, context - –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
    Returns: –°–ª—É—á–∞–π–Ω—ã–π —Ñ–∞–∫—Ç –æ –∂–∏–≤–æ—Ç–Ω—ã—Ö —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
    '''
    method: str = event.get('httpMethod', 'GET')
    
    # Handle CORS OPTIONS request
    if method == 'OPTIONS':
        return {
            'statusCode': 200,
            'headers': {
                'Access-Control-Allow-Origin': '*',
                'Access-Control-Allow-Methods': 'GET, OPTIONS',
                'Access-Control-Allow-Headers': 'Content-Type',
                'Access-Control-Max-Age': '86400'
            },
            'body': ''
        }
    
    # –§–∞–∫—Ç—ã –æ –∂–∏–≤–æ—Ç–Ω—ã—Ö
    animal_facts = [
        {
            "fact": "–û—Å—å–º–∏–Ω–æ–≥–∏ –∏–º–µ—é—Ç —Ç—Ä–∏ —Å–µ—Ä–¥—Ü–∞ –∏ –≥–æ–ª—É–±—É—é –∫—Ä–æ–≤—å",
            "explanation": "–î–≤–∞ —Å–µ—Ä–¥—Ü–∞ –∫–∞—á–∞—é—Ç –∫—Ä–æ–≤—å —á–µ—Ä–µ–∑ –∂–∞–±—Ä—ã, —Ç—Ä–µ—Ç—å–µ - –ø–æ –≤—Å–µ–º—É —Ç–µ–ª—É. –ì–æ–ª—É–±–∞—è –∫—Ä–æ–≤—å –∏–∑-–∑–∞ –≥–µ–º–æ—Ü–∏–∞–Ω–∏–Ω–∞ –≤–º–µ—Å—Ç–æ –≥–µ–º–æ–≥–ª–æ–±–∏–Ω–∞",
            "category": "–º–æ—Ä—Å–∫–∏–µ"
        },
        {
            "fact": "–°–ª–æ–Ω—ã –±–æ—è—Ç—Å—è –ø—á—ë–ª –∏ —É–º–µ—é—Ç –ø–ª–∞–≤–∞—Ç—å",
            "explanation": "–°–ª–æ–Ω—ã –∏–∑–±–µ–≥–∞—é—Ç –ø—á–µ–ª–∏–Ω—ã—Ö —É–ª—å–µ–≤ –∏ –º–æ–≥—É—Ç –ø–ª—ã—Ç—å —á–∞—Å–∞–º–∏, –∏—Å–ø–æ–ª—å–∑—É—è —Ö–æ–±–æ—Ç –∫–∞–∫ —Ç—Ä—É–±–∫—É –¥–ª—è –¥—ã—Ö–∞–Ω–∏—è",
            "category": "–º–ª–µ–∫–æ–ø–∏—Ç–∞—é—â–∏–µ"
        },
        {
            "fact": "–ê–∫—É–ª—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç –¥–æ–ª—å—à–µ –¥–µ—Ä–µ–≤—å–µ–≤",
            "explanation": "–ê–∫—É–ª—ã –ø–æ—è–≤–∏–ª–∏—Å—å 400 –º–ª–Ω –ª–µ—Ç –Ω–∞–∑–∞–¥, –∞ –¥–µ—Ä–µ–≤—å—è - —Ç–æ–ª—å–∫–æ 350 –º–ª–Ω –ª–µ—Ç –Ω–∞–∑–∞–¥",
            "category": "–º–æ—Ä—Å–∫–∏–µ"
        },
        {
            "fact": "–ö–æ—Ç—ã –º—É—Ä–ª—ã–∫–∞—é—Ç –Ω–∞ —á–∞—Å—Ç–æ—Ç–µ, –∫–æ—Ç–æ—Ä–∞—è –ª–µ—á–∏—Ç –∫–æ—Å—Ç–∏",
            "explanation": "–ß–∞—Å—Ç–æ—Ç–∞ 20-50 –ì—Ü —Å—Ç–∏–º—É–ª–∏—Ä—É–µ—Ç –∑–∞–∂–∏–≤–ª–µ–Ω–∏–µ –∫–æ—Å—Ç–µ–π –∏ –º—ã—à—Ü - –ø–æ—ç—Ç–æ–º—É –∫–æ—Ç—ã –±—ã—Å—Ç—Ä–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è",
            "category": "–º–ª–µ–∫–æ–ø–∏—Ç–∞—é—â–∏–µ"
        },
        {
            "fact": "–î–µ–ª—å—Ñ–∏–Ω—ã –¥–∞—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥—É –∏–º–µ–Ω–∞",
            "explanation": "–£ –∫–∞–∂–¥–æ–≥–æ –¥–µ–ª—å—Ñ–∏–Ω–∞ –µ—Å—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å–≤–∏—Å—Ç-–ø–æ–¥–ø–∏—Å—å, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –µ–≥–æ —É–∑–Ω–∞—é—Ç —Å–æ—Ä–æ–¥–∏—á–∏",
            "category": "–º–æ—Ä—Å–∫–∏–µ"
        },
        {
            "fact": "–ü–∏–Ω–≥–≤–∏–Ω—ã –¥–µ–ª–∞—é—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∫–∞–º–µ—à–∫–∞–º–∏",
            "explanation": "–°–∞–º–µ—Ü –ø–∏–Ω–≥–≤–∏–Ω–∞ –∏—â–µ—Ç —Å–∞–º—ã–π –∫—Ä–∞—Å–∏–≤—ã–π –∫–∞–º–µ—à–µ–∫ –∏ –ø–æ–¥–Ω–æ—Å–∏—Ç —Å–∞–º–∫–µ –∫–∞–∫ —Å–∏–º–≤–æ–ª –ª—é–±–≤–∏",
            "category": "–ø—Ç–∏—Ü—ã"
        },
        {
            "fact": "–ú–µ–¥–≤–µ–¥–∏ –º–æ–≥—É—Ç –±–µ–≥–∞—Ç—å —Å–æ —Å–∫–æ—Ä–æ—Å—Ç—å—é 60 –∫–º/—á",
            "explanation": "–ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –∫—Ä—É–ø–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã, –º–µ–¥–≤–µ–¥–∏ —Ä–∞–∑–≤–∏–≤–∞—é—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –±—ã—Å—Ç—Ä–µ–µ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –≤–µ–ª–æ—Å–∏–ø–µ–¥–∏—Å—Ç–æ–≤",
            "category": "–º–ª–µ–∫–æ–ø–∏—Ç–∞—é—â–∏–µ"
        },
        {
            "fact": "–°–æ–≤—ã –Ω–µ –º–æ–≥—É—Ç –¥–≤–∏–≥–∞—Ç—å –≥–ª–∞–∑–∞–º–∏",
            "explanation": "–ì–ª–∞–∑–∞ —Å–æ–≤—ã –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –≤ —á–µ—Ä–µ–ø–µ, –Ω–æ –æ–Ω–∞ –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –≥–æ–ª–æ–≤—É –Ω–∞ 270 –≥—Ä–∞–¥—É—Å–æ–≤",
            "category": "–ø—Ç–∏—Ü—ã"
        }
    ]
    
    # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Ñ–∞–∫—Ç
    selected_fact = random.choice(animal_facts)
    
    # –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
    query_params = event.get('queryStringParameters', {}) or {}
    category_filter = query_params.get('category')
    
    # –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞
    if category_filter:
        filtered_facts = [f for f in animal_facts if f['category'] == category_filter]
        if filtered_facts:
            selected_fact = random.choice(filtered_facts)
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
    result = {
        'success': True,
        'timestamp': context.request_id,  # –ò—Å–ø–æ–ª—å–∑—É–µ–º request_id –∫–∞–∫ timestamp
        'total_facts': len(animal_facts),
        'categories': list(set(f['category'] for f in animal_facts)),
        'fact_data': selected_fact,
        'fun_bonus': f"üêæ –§–∞–∫—Ç #{random.randint(1, 1000)}",
        'request_info': {
            'function_name': 'animal-facts',
            'method': method,
            'filtered_by': category_filter or 'none'
        }
    }
    
    return {
        'statusCode': 200,
        'headers': {
            'Content-Type': 'application/json',
            'Access-Control-Allow-Origin': '*'
        },
        'isBase64Encoded': False,
        'body': json.dumps(result, ensure_ascii=False)
    }